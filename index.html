<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crash Cart Expiration Dashboard</title>
  <!-- Mobile responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --critical-bg: #ffebee;
      --critical-text: #b71c1c;
      --critical-border: #b71c1c;

      --warning-bg: #fff8e1;
      --warning-text: #ff6f00;
      --warning-border: #ff6f00;

      --ok-bg: #e8f5e9;
      --ok-text: #2e7d32;
      --ok-border: #2e7d32;

      --expired-bg: #f3e5f5;
      --expired-text: #4a148c;
      --expired-border: #4a148c;
    }

    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      line-height: 1.5;
      font-size: 16px;
      background: #f7f7f7;
    }

    h1 {
      margin-bottom: 6px;
      font-size: 1.6rem;
    }

    p {
      margin-top: 0;
      color: #555;
      font-size: 0.95rem;
    }

    .unit-section {
      margin-top: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #ffffff;
      overflow: hidden;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
    }

    .unit-header {
      background: #e3e3e3;
      padding: 14px 16px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      outline: none;
    }

    .unit-header:focus-visible {
      box-shadow: 0 0 0 3px #2962ff;
    }

    .unit-header span.unit-name {
      flex: 1;
    }

    .unit-header span.chevron {
      margin-left: 10px;
      font-size: 1rem;
    }

    .unit-body {
      display: none;
      padding: 12px 12px 16px;
      background: #fafafa;
    }

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      min-width: 540px; /* ensures good layout but scrolls on phones */
      background: #ffffff;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 0.85rem;
    }

    th {
      background-color: #f2f2f2;
      font-weight: 600;
      white-space: nowrap;
    }

    tr:nth-child(even) {
      background-color: #fcfcfc;
    }

    .status-pill {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: bold;
      display: inline-block;
      white-space: nowrap;
    }

    .status-critical {
      background-color: var(--critical-bg);
      color: var(--critical-text);
      border: 1px solid var(--critical-border);
    }

    .status-warning {
      background-color: var(--warning-bg);
      color: var(--warning-text);
      border: 1px solid var(--warning-border);
    }

    .status-ok {
      background-color: var(--ok-bg);
      color: var(--ok-text);
      border: 1px solid var(--ok-border);
    }

    .status-expired {
      background-color: var(--expired-bg);
      color: var(--expired-text);
      border: 1px solid var(--expired-border);
    }

    .unit-summary {
      font-size: 0.85rem;
      color: #444;
      margin-top: 4px;
    }

    .unit-summary strong {
      font-weight: 600;
    }

    /* Mobile tweaks */
    @media (max-width: 768px) {
      body {
        padding: 12px;
        font-size: 15px;
      }

      h1 {
        font-size: 1.3rem;
      }

      .unit-header {
        padding: 12px;
      }

      th, td {
        font-size: 0.8rem;
        padding: 6px;
      }
    }
  </style>
</head>

<body>
  <h1>Crash Cart Expiration Dashboard</h1>
  <p>
    Units: 2 SOUTH, 2 EAST, 3 SOUTH, 3 EAST.  
    Each section shows items sorted by soonest expiration and color-coded by status.
  </p>

  <script>
    // ================================
    // 1 — DATA (EDIT ONLY THIS PART)
    // ================================
    // Use YYYY-MM-DD for expiration_date
    const crashCarts = {
      "2 SOUTH": [
        { name: "Epinephrine 1:10,000", type: "Medication", location: "Top Drawer",    expiration_date: "2025-12-01" },
        { name: "Atropine 1 mg",        type: "Medication", location: "Top Drawer",    expiration_date: "2025-11-28" },
        { name: "Defib Pads Adult",     type: "Supply",     location: "Side Compartment", expiration_date: "2026-04-15" }
      ],
      "2 EAST": [
        { name: "Amiodarone 150 mg",    type: "Medication", location: "Top Drawer",    expiration_date: "2026-02-10" },
        { name: "10 mL Saline Flush",   type: "Supply",     location: "Middle Drawer", expiration_date: "2025-12-05" }
      ],
      "3 SOUTH": [
        { name: "IV Start Kit",         type: "Supply",     location: "Middle Drawer", expiration_date: "2027-03-01" },
        { name: "Atropine 1 mg",        type: "Medication", location: "Top Drawer",    expiration_date: "2025-11-30" }
      ],
      "3 EAST": [
        { name: "Epinephrine 1:1,000",  type: "Medication", location: "Top Drawer",    expiration_date: "2026-01-12" },
        { name: "Defib Pads Adult",     type: "Supply",     location: "Side Compartment", expiration_date: "2025-12-20" }
      ]
    };

    // ================================
    // 2 — HELPERS
    // ================================
    function slugifyUnitName(unitName) {
      return unitName.toLowerCase().replace(/[^a-z0-9]+/g, "-");
    }

    function parseDate(dateStr) {
      const p = dateStr.split("-");
      return new Date(p[0], p[1] - 1, p[2]);
    }

    function daysFromToday(targetDate) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const diff = targetDate - today;
      return Math.round(diff / (1000 * 60 * 60 * 24));
    }

    function getStatusClass(days) {
      if (days < 0)  return { label: "Expired",          className: "status-expired" };
      if (days <= 30) return { label: "Critical (≤30d)", className: "status-critical" };
      if (days <= 90) return { label: "Warning (31–90d)",className: "status-warning" };
      return { label: "OK (>90d)",                       className: "status-ok" };
    }

    function buildUnitSection(unitName, items) {
      const section = document.createElement("div");
      section.className = "unit-section";

      const header = document.createElement("div");
      header.className = "unit-header";
      header.setAttribute("role", "button");
      header.setAttribute("tabindex", "0");

      const slug = slugifyUnitName(unitName);
      const bodyId = `body-${slug}`;
      header.setAttribute("aria-controls", bodyId);
      header.setAttribute("aria-expanded", "false");

      const nameSpan = document.createElement("span");
      nameSpan.className = "unit-name";
      nameSpan.textContent = unitName;

      const chevron = document.createElement("span");
      chevron.className = "chevron";
      chevron.textContent = "▾";

      header.appendChild(nameSpan);
      header.appendChild(chevron);

      const body = document.createElement("div");
      body.className = "unit-body";
      body.id = bodyId;
      body.setAttribute("aria-hidden", "true");

      // Process items: add days + sort by soonest
      const processed = items.map(item => {
        const expDate = parseDate(item.expiration_date);
        const days = daysFromToday(expDate);
        return { ...item, expDate, days };
      }).sort((a, b) => a.expDate - b.expDate);

      // Quick mini summary for the unit
      const unitSummary = document.createElement("div");
      unitSummary.className = "unit-summary";

      if (processed.length > 0) {
        const next = processed[0];
        unitSummary.innerHTML =
          `<strong>Next to expire:</strong> ${next.name} ` +
          `(${next.type}) in ${next.days} days on ${next.expiration_date}`;
      } else {
        unitSummary.textContent = "No items defined for this unit.";
      }

      // Build table
      const tableWrapper = document.createElement("div");
      tableWrapper.className = "table-wrapper";

      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr>
            <th>Item</th>
            <th>Type</th>
            <th>Location</th>
            <th>Expiration Date</th>
            <th>Days Remaining</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector("tbody");

      processed.forEach(item => {
        const s = getStatusClass(item.days);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.type}</td>
          <td>${item.location}</td>
          <td>${item.expiration_date}</td>
          <td>${item.days}</td>
          <td><span class="status-pill ${s.className}">${s.label}</span></td>
        `;
        tbody.appendChild(tr);
      });

      tableWrapper.appendChild(table);
      body.appendChild(unitSummary);
      body.appendChild(tableWrapper);

      // Toggle behavior (click + keyboard)
      function toggleBody() {
        const isOpen = body.style.display === "block";
        body.style.display = isOpen ? "none" : "block";
        header.setAttribute("aria-expanded", String(!isOpen));
        body.setAttribute("aria-hidden", String(isOpen));
        chevron.textContent = isOpen ? "▾" : "▴";
      }

      header.addEventListener("click", toggleBody);
      header.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleBody();
        }
      });

      section.appendChild(header);
      section.appendChild(body);
      return section;
    }

    // ================================
    // 3 — BUILD PAGE
    // ================================
    document.addEventListener("DOMContentLoaded", () => {
      for (const unit in crashCarts) {
        const section = buildUnitSection(unit, crashCarts[unit]);
        document.body.appendChild(section);
      }
    });
  </script>
</body>
</html>
